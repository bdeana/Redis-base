<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8" />
    <title>Hoteli na karti Hrvatske</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <style>
        #map { height: 600px; width: 100%; margin-top: 20px; }
    </style>
</head>

<body>
    <h1>Hoteli u Hrvatskoj na karti</h1>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script>

        function isInEurope(lat, lon) {

    return (
        lat >= 35 && lat <= 72 &&    // g.širina: Krete -  Norveške
        lon >= -25 && lon <= 45      // g.dužina: Portugala - Rusije
    );
}
        const map = L.map('map').setView([50, 15], 4);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors',
    maxZoom: 18
}).addTo(map);
        const hotels = [
        {% for hotel in hotels %}
            {% if hotel.Map and '|' in hotel.Map %}
                {
                    name: {{ hotel.HotelName|tojson }},
                    address: {{ hotel.Address|tojson }},
                    lat: parseFloat("{{ hotel.Map.split('|')[0] }}"),
                    lon: parseFloat("{{ hotel.Map.split('|')[1] }}"),
                    code: {{ hotel.HotelCode|tojson }}
                },
            {% endif %}
        {% endfor %}
    ];

    const markers = L.markerClusterGroup();

    hotels.forEach(hotel => {
    if (
        !isNaN(hotel.lat) &&
        !isNaN(hotel.lon) &&
        hotel.code &&
        hotel.code.toString().trim() !== '' &&
        isInEurope(hotel.lat, hotel.lon) 
    ) {
        const marker = L.marker([hotel.lat, hotel.lon]);
        marker.bindPopup(`<b><a href="/hotel/${encodeURIComponent(hotel.code)}" target="_blank">${hotel.name}</a></b><br>${hotel.address}`);
        markers.addLayer(marker);
    }
});

    map.addLayer(markers);
    </script>
</body>
</html>
